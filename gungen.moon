-- title:  Tiny Gun Generator
-- author: congusbongus
-- desc:   Randomly generate pixel gun icons
-- script: moon

S_UPPER=0
S_GRIP=48

N_PARTS = {
	upper:10,
	grip:10,
}

indices = {
	upper:0,
	grip:0,
}

modwrap=(x,m)->
	(x%m+m)%m

class Menu
    new:(x=0,y=0,index=1)=>
        @x=x
        @y=y
        @index=index
        @items={}
    
    add:(text)=>
        table.insert(@items,text)

    prev:=>
        i=@index-1
        if i<1
            @index=#@items
        else
            @index=i
    
    next:=>
        i=@index+1
        if i>#@items
            @index=1
        else
            @index=i
    
    draw:(sel="> ",usel="  ",spc=10,col=15)=>
        for k,v in ipairs(@items)
            dy=@y+(k-1)*spc
            if @index==k
                print(sel..v.." "..indices[v],@x,dy,col)
            else
                print(usel..v.." "..indices[v],@x,dy,col)

menu = Menu 128,20
menu\add "upper"
menu\add "grip"

drawgun=(x,y,scale)->
	-- Draw upper
	spr (indices.upper+S_UPPER)*2,x,y+1*scale,0,scale,0,0,1,1
	-- Draw barrel of upper
	spr (indices.upper+S_UPPER)*2+1,x+8*scale,y+1*scale,0,scale,0,0,1,1
	-- Draw grip
	spr indices.grip+S_GRIP,x,y+(8-1)*scale,0,scale,0,0,1,1

export TIC=->
	var=menu.items[menu.index]
	if btnp 0	-- up
		menu\prev!
	if btnp 1	-- down
		menu\next!
	if btnp(2) or btnp(5)	-- left or B
		indices[var]=modwrap indices[var]-1,N_PARTS[var]
	if btnp(3) or btnp(4)	-- right or A
		indices[var]=modwrap indices[var]+1,N_PARTS[var]

	cls 0
	-- Draw gun in multiple scales
	drawgun 40,0,1
	drawgun 35,12,2
	drawgun 30,35,3
	drawgun 25,70,4
	menu\draw!

-- <TILES>
-- 000:0000000000000000000000000000000000aaaaee0a77aaee0aaaaaaa00a00000
-- 001:00000000000000000000000000000000eeee0000eeee0000aaa0000000000000
-- 002:0000000000000000000000000000eeee000efffa000e777e000eeeee00000000
-- 003:00000000000000000000000000e00000aaa00000eee000000000000000000000
-- 004:000000000000000000000000000000000000000000eeaaee0eeaaeee00e00000
-- 005:0000000000000000000000000000000000000000eee00000eaa0000000000000
-- 006:00000000000000000000000000000000000eaaee00e555ee0055555500000000
-- 007:00000000000000000000000000000000aaa7000055550000aaaa000000000000
-- 008:000000000000000000000000000000000000000000aaaaaa0077777700000000
-- 009:0000000000000000000000000000000000000000aaaa00007777000000000000
-- 010:0000000000000000000000000000000000eaaa110e7777770a11111100000000
-- 011:00000000000000000000000000000000aaa77000777770001100000000000000
-- 012:0000000000000000000000000000700000f77aaa0077777700a1161100000000
-- 013:0000000000000000000000000700000077a00000777100001111100000000000
-- 014:000000000000000000000000000000000fe00007feeaaaaae77777770e000000
-- 015:0000000000000000000000000000000000007000eeeee0007777700000000000
-- 016:00000000000000000000000000000007000e11ee00071177000eeeee00000000
-- 017:00000000000000000000000000700000eee0000077777000eee0000000000000
-- 018:0000000000000000000000000000ff70000777770077eeee0077777700000000
-- 019:0000000000000000000000000000000000000000000000007000000000000000
-- 048:00000000000110070001177700711e0000711e0000011e00000eee0000000000
-- 049:004000000444e00e33344eee3340000033400000000000000000000000000000
-- 050:00000000000ff007000ff77000ffe00000ffe00000eee0000000000000000000
-- 051:0000000000057705000577550077770000777000007770000000000000000000
-- 052:0000000000077007000777770077700000777000007770000000000000000000
-- 053:0000000000077007000aa7770077100000771000001110000000000000000000
-- 054:00000000000077010000a7100000aa0000000000000000000000000000000000
-- 055:000000000077a00100eaa11000aa70000ea7000000e700000000000000000000
-- 056:000000000000aa070000aa770000aa000000aa00000177000000770000007700
-- 057:0000000000077071001777100000700000000000000000000000000000000000
-- 064:0000000000070000000700000007000000000000000000000000000000000000
-- 065:00007a0000007a000000a1000000000000000000000000000000000000000000
-- 080:000000000000000000000000000001aa00000100000001000000000000000000
-- 081:0000000000000000000000e7000000ee000000ee000000110000001000000000
-- 082:00000000000000000aaaaeee0a7777770a777770011117770000007700000000
-- 096:0000e000000ae000000a700000077000000a7000000a7000000a700000000000
-- </TILES>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <PALETTE>
-- 000:140c1c302c3030346d402428714c304c5548d04648757161597dced27d2c9195916daa2cd2aa996dc2cababebedeeed6
-- </PALETTE>

